;(function($){var pluginName="mapify";var mapDefaults={zoom:20,minZoom:0,autoFitBounds:true,placeMarkers:false,action:"drawMap",markers:[],center:null,centerIcon:"",centerTitle:"Center",mapTypeId:"roadmap",apiKey:""};var Plugin=function(element,options){this.element=element;this.name=pluginName;this.aMarker=[];this.bounds={};this.init(options)};Plugin.prototype.checkGAPIReady=function(){var gReady=(typeof google==='object'&&typeof google.maps==='object');return gReady};Plugin.prototype.init=function(options){this.settings=$.extend(mapDefaults,options);var _this=this;if(this.checkGAPIReady()){this.checkAction()}else{this.getApi(function(){_this.checkAction()})}};Plugin.prototype.checkAction=function(){action=this.settings.action;if(action=="drawMap"){var markers=this.settings.markers;this.drawMap();this.drawMarkers(markers)}else if(action=="addMarkers"){var markers=this.settings.markers;this.drawMarkers(markers)}else{onError("invalid action parameter passed")}};Plugin.prototype.getApi=function(callback){_this=this;if(this.settings.apiKey.length>0){var apiUrl="https://maps.google.com/maps/api/js?key="+this.settings.apiKey}else{var apiUrl="https://maps.google.com/maps/api/js"}$.getScript(apiUrl,function(){callback()}).fail(function(error){var sError="error getting the api script";onError(sError)})};var onError=function(sError){fireEvent("onError",sError,"sError")};var fireEvent=function(eventname,eventdata,detailname){if(eventdata!=null&&detailname!=null){var detailData={'detail':{}};detailData.detail[detailname]=eventdata;var event=new CustomEvent(eventname,detailData)}else{var event=new CustomEvent(eventname)}document.dispatchEvent(event)};Plugin.prototype.drawMap=function(){var _this=this;var thissett=this.settings;this.map=new google.maps.Map(_this.element,thissett);this.bounds=new google.maps.LatLngBounds();google.maps.event.addListenerOnce(_this.map,'idle',function(){fireEvent("onReady")});if(thissett.placeMarkers){google.maps.event.addListener(_this.map,'click',function(e){var tmpMarker={position:e.latLng,map:_this.map};_this.drawMarker(tmpMarker)})}if(thissett.center!==null){var tmpMarker={position:thissett.center,icon:thissett.centerIcon,title:thissett.centerTitle};this.drawMarker(tmpMarker)}};Plugin.prototype.drawMarker=function(marker){var _this=this;var tmpMarker=new google.maps.Marker({position:marker.position,map:this.map,title:marker.title,icon:marker.icon});tmpMarker.addListener('click',function(){fireEvent("onMarkerClick",tmpMarker,"marker")});tmpMarker.setMap(this.map);this.aMarker.push(tmpMarker);if(this.settings.autoFitBounds){this.bounds.extend(tmpMarker.getPosition());this.map.fitBounds(this.bounds)}};Plugin.prototype.drawMarkers=function(markers){for(var numMarker=0;numMarker<markers.length;numMarker+=1){this.drawMarker(markers[numMarker])}};$.fn[pluginName]=function(options){this.each(function(){var pName="plugin_"+pluginName;if(!$.data(this,pName)){$.data(this,pName,new Plugin(this,options))}else{_this.init(options)}});return this}}(jQuery));